var Monitor={VERSION_NUMBER:"Development 0.1",_getScriptLocation:function(){for(var t,e,r=new RegExp("(^|(.*?\\/))(Monitor[^\\/]*?\\.js)(\\?|$)"),i=document.getElementsByTagName("script"),n="",o=0,s=i.length;s>o;o++)if(t=i[o].getAttribute("src"),t&&(e=t.match(r))){n=e[1];break}return function(){return n}}(),ImgPath:""};Monitor.String={trim:function(t){return t.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(t){return t.replace(/(\-[A-Za-z])/g,function(t){return t.toUpperCase().replace("-","")})}},Monitor.Array={contains:function(t,e){return e&&t&&-1!=t.indexOf(e)},remove:function(t,e){for(var r=0;r<t.length;r++)t[r]==e&&t.splice(r,1)}},Monitor.Function={bind:function(t,e){var r=Array.prototype.slice.apply(arguments,[2]);return function(){var i=r.concat(Array.prototype.slice.apply(arguments,[0]));return t.apply(e,i)}},bindAsEventListener:function(t,e){return function(r){return t.call(e,r||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}},Monitor.Class=function(){var t=arguments.length,e=arguments[0],r=arguments[t-1],i="function"==typeof r.init?r.init:function(){e.prototype.init.apply(this,arguments)};if(t>1){var n=[i,e].concat(Array.prototype.slice.call(arguments).slice(1,t-1),r);Monitor.inherit.apply(null,n)}else i.prototype=r;return i},Monitor.inherit=function(t,e){var r=function(){};r.prototype=e.prototype,t.prototype=new r;var i,n,o;for(i=2,n=arguments.length;n>i;i++)o=arguments[i],"function"==typeof o&&(o=o.prototype),Monitor.Util.extend(t.prototype,o)},Monitor.Util=Monitor.Util||{},Monitor.Util.extend=function(t,e){if(t=t||{},e){for(var r in e){var i=e[r];void 0!==i&&(t[r]=i)}var n="function"==typeof window.Event&&e instanceof window.Event;!n&&e.hasOwnProperty&&e.hasOwnProperty("toString")&&(t.toString=e.toString)}return t},Monitor.Element={create:function(t,e){var r=document.createElement(t);if(e)for(var i in e)if("style"==i.toLowerCase())for(var n in e[i]){var o=e[i][n];n=Monitor.String.camelize(n),r.style[n]=o}else r.setAttribute(i,e[i]);return r},hasClass:function(t,e){var r=t.className;return!!r&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(r)},addClass:function(t,e){return Monitor.Element.hasClass(t,e)||(t.className+=(t.className?" ":"")+e),t},removeClass:function(t,e){var r=t.className;return r&&(t.className=Monitor.String.trim(r.replace(new RegExp("(^|\\s+)"+e+"(\\s+|$)")," "))),t},getStyle:function(t,e){t=Monitor.Util.getElement(t);var r=null;if(t&&t.style){if(r=t.style[Monitor.String.camelize(e)],!r)if(document.defaultView&&document.defaultView.getComputedStyle){var i=document.defaultView.getComputedStyle(t,null);r=i?i.getPropertyValue(e):null}else t.currentStyle&&(r=t.currentStyle[Monitor.String.camelize(e)]);var n=["left","top","right","bottom"];window.opera&&-1!=Monitor.Util.indexOf(n,e)&&"static"==Monitor.Element.getStyle(t,"position")&&(r="auto")}return"auto"==r?null:r}},Monitor.Util=Monitor.Util||{},Monitor.Util.lastSeqID=0,Monitor.Util.createUniqueID=function(t){return t=null==t?"id_":t.replace(Monitor.Util.dotless,"_"),Monitor.Util.lastSeqID+=1,t+Monitor.Util.lastSeqID},Monitor.Util.applyDefaults=function(t,e){t=t||{};var r="function"==typeof window.Event&&e instanceof window.Event;for(var i in e)(void 0===t[i]||!r&&e.hasOwnProperty&&e.hasOwnProperty(i)&&!t.hasOwnProperty(i))&&(t[i]=e[i]);return!r&&e&&e.hasOwnProperty&&e.hasOwnProperty("toString")&&!t.hasOwnProperty("toString")&&(t.toString=e.toString),t},Monitor.Util.getParameters=function(t,e){e=e||{},t=null===t||void 0===t?window.location.href:t;var r="";if(-1!=t.indexOf("?")){var i=t.indexOf("?")+1,n=-1!=t.indexOf("#")?t.indexOf("#"):t.length;r=t.substring(i,n)}for(var o={},s=r.split(/[&;]/),a=0,l=s.length;l>a;++a){var h=s[a].split("=");if(h[0]){var u=h[0];try{u=decodeURIComponent(u)}catch(c){u=unescape(u)}var d=(h[1]||"").replace(/\+/g," ");try{d=decodeURIComponent(d)}catch(c){d=unescape(d)}e.splitArgs!==!1&&(d=d.split(",")),1==d.length&&(d=d[0]),o[u]=d}}return o},Monitor.Util.createUrlObject=function(t,e){if(e=e||{},!/^\w+:\/\//.test(t)){var r=window.location,i=r.port?":"+r.port:"",n=r.protocol+"//"+r.host.split(":").shift()+i;if(0===t.indexOf("/"))t=n+t;else{var o=r.pathname.split("/");o.pop(),t=n+o.join("/")+"/"+t}}e.ignoreCase&&(t=t.toLowerCase());var s=document.createElement("a");s.href=t;var a={};a.host=s.host.split(":").shift(),a.protocol=s.protocol,e.ignorePort80?a.port="80"==s.port||"0"==s.port?"":s.port:a.port=""==s.port||"0"==s.port?"80":s.port,a.hash=e.ignoreHash||"#"===s.hash?"":s.hash;var l=s.search;if(!l){var h=t.indexOf("?");l=-1!=h?t.substr(h):""}return a.args=Monitor.Util.getParameters(l,{splitArgs:e.splitArgs}),a},Monitor.Util.isEquivalentUrl=function(t,e,r){r=r||{},Monitor.Util.applyDefaults(r,{ignoreCase:!0,ignorePort80:!0,ignoreHash:!0,splitArgs:!1});var i=Monitor.Util.createUrlObject(t,r),n=Monitor.Util.createUrlObject(e,r);for(var o in i)if("args"!==o&&i[o]!=n[o])return!1;for(var o in i.args){if(i.args[o]!=n.args[o])return!1;delete n.args[o]}for(var o in n.args)return!1;return!0},Monitor.IS_GECKO=function(){var t=navigator.userAgent.toLowerCase();return-1==t.indexOf("webkit")&&-1!=t.indexOf("gecko")}(),Monitor.Util.pagePosition=function(t){var e=[0,0],r=Monitor.Util.getViewportElement();if(!t||t==window||t==r)return e;var i,n=Monitor.IS_GECKO&&document.getBoxObjectFor&&"absolute"==Monitor.Element.getStyle(t,"position")&&(""==t.style.top||""==t.style.left),o=null;if(t.getBoundingClientRect){i=t.getBoundingClientRect();var s=window.pageYOffset||r.scrollTop,a=window.pageXOffset||r.scrollLeft;e[0]=i.left+a,e[1]=i.top+s}else if(document.getBoxObjectFor&&!n){i=document.getBoxObjectFor(t);var l=document.getBoxObjectFor(r);e[0]=i.screenX-l.screenX,e[1]=i.screenY-l.screenY}else{if(e[0]=t.offsetLeft,e[1]=t.offsetTop,o=t.offsetParent,o!=t)for(;o;)e[0]+=o.offsetLeft,e[1]+=o.offsetTop,o=o.offsetParent;var h=Monitor.BROWSER_NAME;for(("opera"==h||"safari"==h&&"absolute"==Monitor.Element.getStyle(t,"position"))&&(e[1]-=document.body.offsetTop),o=t.offsetParent;o&&o!=document.body;)e[0]-=o.scrollLeft,("opera"!=h||"TR"!=o.tagName)&&(e[1]-=o.scrollTop),o=o.offsetParent}return e},Monitor.Util.indexOf=function(t,e){if("function"==typeof t.indexOf)return t.indexOf(e);for(var r=0,i=t.length;i>r;r++)if(t[r]==e)return r;return-1},Monitor.Util.getElement=function(){for(var t=[],e=0,r=arguments.length;r>e;e++){var i=arguments[e];if("string"==typeof i&&(i=document.getElementById(i)),1==arguments.length)return i;t.push(i)}return t},Monitor.Util.getViewportElement=function(){var t=arguments.callee.viewportElement;return void 0==t&&(t="msie"==Monitor.BROWSER_NAME&&"CSS1Compat"!=document.compatMode?document.body:document.documentElement,arguments.callee.viewportElement=t),t},Monitor.Util.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},Monitor.Event={bind:function(t,e,r,i){if(this.listeners||(this.listeners={}),!t.__eventCatchId__){var n="__eventCatchId__";t.id&&(n=t.id+n),t.__eventCatchId__=Monitor.Util.createUniqueID(n)}var o=t.__eventCatchId__,s=this.listeners[o];if(s)for(var a=0,l=s.length;l>a;a++){var h=s[a];if(h.type==e&&h.func==r&&h.useCapture==i)return}else s=[],this.listeners[o]=s;s.push({element:t,type:e,func:r,useCapture:i}),t.addEventListener(e,r,i)},unbind:function(t,e,r,i){var n=t.__eventCatchId__,o=this.listeners[n],s=!1;if(o)for(var a=0,l=o.length;l>a;a++){var h=o[a];if(h.type==e&&h.func==r&&h.useCapture==i){s=!0,o.splice(a,1),0==o.length&&delete Monitor.Event.observers[cacheID];break}}s&&t.removeEventListener(e,r,i)},unbindElement:function(t){var e=t.__eventCatchId__,r=this.listeners[e];if(r){for(var i=r.length;i--;){var n=r[i];t.removeEventListener(n.type,n.observer,n.useCapture)}r.length=0,delete Monitor.Event.observers[cacheID]}},CLASS_NAME:"Monitor.Event"},Monitor.Events=Monitor.Class({BROWSER_EVENTS:["mousedown","mouseup","mousemove"],object:null,element:null,options:null,listeners:null,includeXY:!1,init:function(t,e,r){Monitor.Util.extend(this,r),this.object=t,this.listeners={},e&&this.bindBrowserEventsToElement(e)},bindBrowserEventsToElement:function(t){this.element?Monitor.Event.unbindElement(this.element):this.eventHandler=Monitor.Function.bindAsEventListener(this.handleBrowserEvent,this),this.element=t;for(var e,r=0;r<this.BROWSER_EVENTS.length;r++)e=this.BROWSER_EVENTS[r],Monitor.Event.bind(t,e,this.eventHandler)},handleBrowserEvent:function(t){var e=t.type,r=this.listeners[e];if(r&&0!=r.length){if(this.includeXY){var i=t.touches,n=0,o=0;if(i&&i[0]){for(var s,a=i.length,l=0;a>l;++l)s=i[l],n+=s.pageX,o+=s.pageY;t.clientX=n/a,t.clientY=o/a}else n=t.pageX,o=t.pageY;t.xy={x:n,y:o},this.adjustXY(t.xy)}this.trigger(e,t)}},register:function(t,e,r,i){if(r){null==e&&(e=this.object);var n=this.listeners[t];n||(n=[],this.listeners[t]=n);var o={obj:e,func:r};i?n.unshift(o):n.push(o)}},unregister:function(t,e,r){if(r){null==e&&(e=this.object);var i=this.listeners[t];if(i)for(var n=0;n<i.length;n++)if(i[n].obj==e&&i[n].func==r){i.splice(n,1);break}}},trigger:function(t,e){var r=this.listeners[t];if(!r||0==r.length)return void 0;null==e&&(e={}),e.object=this.object,e.element=this.element,e.type||(e.type=t),r=r.slice();for(var i,n=0;n<r.length;n++){var o=r[n];if(i=o.func.call(o.obj,e),void 0!=i&&0==i)break}return i},adjustXY:function(t){var e=this.element.getBoundingClientRect();t.x-=e.left+document.body.scrollLeft,t.y-=e.top+document.body.scrollTop},CLASS_NAME:"Monitor.Events"}),Monitor.Map=Monitor.Class({div:null,viewportDiv:null,layers:null,controls:null,options:null,init:function(t,e){this.options=Monitor.Util.extend(this.options,e),this.layers=[],this.controls=[],this.div=document.getElementById(t),this.viewportDiv=Monitor.Element.create("div",{style:{border:"solid 1px red",width:"100%",height:"100%",position:"relative"}}),this.div.appendChild(this.viewportDiv),this.events=new Monitor.Events(this,this.viewportDiv,{includeXY:!0})},addLayer:function(t){t.setMap(this),this.layers.push(t)},removeLayer:function(t){for(var e=0;e<this.layers.length;e++)if(this.layer[e]==t){t.removeMap(this),this.layers.splice(e,1);break}},addControl:function(t){t.setMap(this),this.controls.push(t)},ClASS_NAME:"Monitor.Map"}),Monitor.Renderer=Monitor.Class({layer:null,canvas:null,context:null,matrix:null,init:function(t,e){this.layer=t,this.canvas=Monitor.Element.create("canvas",{style:{}}),t.div.appendChild(this.canvas),this.context=this.canvas.getContext("2d"),this.matrix=[1,0,0,1,0,0]},updateSize:function(){var t=this.layer.div.getBoundingClientRect();this.canvas.width=t.width,this.canvas.height=t.height},setOrigin:function(t,e){this.originX=t,this.originY=e},setStyle:function(t){this.context.fillStyle=t.fill,this.context.strokeStyle=t.stroke,this.context.lineWidth=t.strokeThickness,this.context.font=t.font},setTransform:function(t){t||(t=this.matrix),this.context.setTransform(t[0],t[1],t[2],t[3],t[4]+this.originX,t[5]+this.originY)},eraseFeatures:function(t){Monitor.Util.isArray(t)||(t=[t]);for(var e,r=0;r<t.length;r++)e=t[r].geometry.getBounds(),this.clear(e.left,e.top,e.width,e.height)},erase:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},clear:function(t,e,r,i){this.context.beginPath(),this.context.clearRect(t,e,r,i)},drawRectangle:function(t,e,r,i,n,o){this.context.save(),this.setStyle(t),this.context.beginPath(),this.setTransform(o),this.context.rect(e,r,i,n),t.fill&&this.context.fill(),t.stroke&&this.context.stroke(),this.context.restore()},drawLine:function(t,e,r,i,n,o){this.context.save(),this.setStyle(t),this.context.beginPath(),this.setTransform(o),this.context.moveTo(e,r),this.context.lineTo(i,n),this.context.stroke(),this.context.restore()},drawCircle:function(t,e,r,i,n){this.context.save(),this.setStyle(t),this.context.beginPath(),this.setTransform(n),this.context.arc(e,r,i,0,2*Math.PI),t.fill&&this.context.fill(),t.stroke&&this.context.stroke(),this.context.restore()},drawText:function(t,e,r,i,n,o,s){this.context.save(),this.setStyle(t);var a=this.context.measureText(e);r+=a.width*n,i+=window.parseInt(/\d+px/i.exec(this.context.font),10)*o,this.context.beginPath(),this.setTransform(s),t.fill&&this.context.fillText(e,r,i),t.stroke&&this.context.strokeText(e,r,i),this.context.restore()},CLASS_NAME:"Monitor.Renderer"}),Monitor.Pen=Monitor.Class({strokeThickness:0,init:function(t){Monitor.Util.extend(this,t)},ClASS_NAME:"Monitor.Pen"}),Monitor.Layer=Monitor.Class({id:null,name:null,div:null,options:null,map:null,events:null,init:function(t,e){this.name=t,this.options=Monitor.Util.extend(this.options,e),this.div=Monitor.Element.create("div",{style:{position:"absolute",width:"100%",height:"100%"}})},setMap:function(t){this.map=t,this.map.viewportDiv.appendChild(this.div)},removeMap:function(t){this.map=null,this.map.viewportDiv.removeChild(this.div)},ClASS_NAME:"Monitor.Layer"}),Monitor.Layer.Vector=Monitor.Class(Monitor.Layer,{options:null,renderer:null,map:null,features:null,init:function(t,e){Monitor.Layer.prototype.init.apply(this,arguments),this.renderer=new Monitor.Renderer(this),this.features=[]},setMap:function(t){Monitor.Layer.prototype.setMap.apply(this,arguments),this.renderer.updateSize()},addFeatures:function(t){Monitor.Util.isArray(t)||(t=[t]);for(var e,r=0;r<t.length;r++)e=t[r],e.layer=this,e.draw(),this.features.push(e)},removeFeatures:function(t){var e=!1;Monitor.Util.isArray(t)?t||(t=this.features,e=!0):t=[t];for(var r,i=0;i<t.length;i++)r=t[i],r.layer=null,e||Monitor.Array.remove(this.features,r);e&&(this.features.length=0),this.redraw()},getFeatureFromXY:function(t){for(var e=this.features.length;e--;)if(this.features[e].geometry.isPointInRange(t.x,t.y))return this.features[e]},redraw:function(){this.renderer.erase();for(var t=this.features.length,e=0;t>e;e++)this.features[e].draw()},ClASS_NAME:"Monitor.Layer.Vector"}),Monitor.Feature=Monitor.Class({id:null,layer:null,modifyLayer:null,init:function(){this.id=Monitor.Util.createUniqueID(this.CLASS_NAME)},CLASS_NAME:"Monitor.Feature"}),Monitor.Feature.Vector=Monitor.Class(Monitor.Feature,{attributes:null,geometry:null,init:function(t,e){Monitor.Feature.prototype.init.apply(this),this.geometry=t,this.attributes=e},draw:function(){this.layer&&this.geometry.draw(this.layer.renderer)},CLASS_NAME:"Monitor.Feature"}),Monitor.Geometry=Monitor.Class({id:null,width:0,height:0,x:0,y:0,backgroundColor:"#fff",foregroundColor:"#333",_left:0,_top:0,_right:0,_bottom:0,minWidth:50,minHeight:50,bounds:null,init:function(t){Monitor.Util.extend(this,t)},draw:function(t){t.setOrigin(this.x,this.y)},isPointInRange:function(t,e){return t>this.bounds.left&&t<this.bounds.left+this.bounds.width&&e>this.bounds.top&&e<this.bounds.top+this.bounds.height},isBoundsInRange:function(t){return this.isPointInRange(t.left,t.top)||this.isPointInRange(t.left+t.width,t.top)||this.isPointInRange(t.left+t.width,t.top+t.height)||this.isPointInRange(t.left,t.top+t.height)},move:function(t,e){this.x+=t,this.y+=e},resize:function(t,e){this.width+=t,this.height+=e},getBounds:function(){return this.bounds||(this.bounds={}),this.bounds.left=this.x-this._left,this.bounds.top=this.y-this._top,this.bounds.width=this.width+this._right+this._left,this.bounds.height=this.height+this._bottom+this._top,this.bounds},CLASS_NAME:"Monitor.Geometry"}),Monitor.Geometry.Rectangle=Monitor.Class(Monitor.Geometry,{pen:null,init:function(t){Monitor.Geometry.prototype.init.apply(this,arguments)},draw:function(t){Monitor.Geometry.prototype.draw.apply(this,arguments),t.drawRectangle(this.pen,0,0,this.width,this.height),this._left=this._top=this._right=this._bottom=Math.round(this.pen.strokeThickness/2),this.getBounds()},CLASS_NAME:"Monitor.Geometry.Rectangle"}),Monitor.Geometry.Circle=Monitor.Class(Monitor.Geometry,{pen:null,init:function(t){Monitor.Geometry.prototype.init.apply(this,arguments)},draw:function(t){Monitor.Geometry.prototype.draw.apply(this,arguments),t.drawCircle(this.pen,.5*this.width,.5*this.height,.5*this.width),this.getBounds()},isPointInRange:function(t,e){var r=.5*this.width,i=this.x+.5*this.width,n=this.y+.5*this.height;return r*r>(i-t)*(i-t)+(n-e)*(n-e)},CLASS_NAME:"Monitor.Geometry.Circle"}),Monitor.Handler=Monitor.Class({control:null,callbacks:null,active:!1,evt:null,init:function(t,e,r){Monitor.Util.extend(this,r),this.control=t,this.callbacks=e;var i=this.map||t.map;i&&this.setMap(i)},setMap:function(t){this.map=t},activate:function(){if(this.active)return!1;for(var t=Monitor.Events.prototype.BROWSER_EVENTS,e=0;e<t.length;e++)this[t[e]]&&this.register(t[e],this[t[e]]);return this.active=!0,this.active},deactivate:function(){if(!this.active)return!1;for(var t=Monitor.Events.prototype.BROWSER_EVENTS,e=0;e<t.length;e++)this[t[e]]&&this.unregister(t[e],this[t[e]]);return this.active=!1,!0},register:function(t,e){this.map.events.register(t,this,e),this.map.events.register(t,this,this.setEvent)},unregister:function(t,e){this.map.events.unregister(t,this,e),this.map.events.unregister(t,this,this.setEvent)},setEvent:function(t){return this.evt=t,!0},callback:function(t,e){this.callbacks&&this.callbacks[t]&&this.callbacks[t].call(this.control,e)},checkModifiers:function(t){if(null==this.keyMask)return!0;var e=(t.shiftKey?Monitor.Handler.MOD_SHIFT:0)|(t.ctrlKey?Monitor.Handler.MOD_CTRL:0)|(t.altKey?Monitor.Handler.MOD_ALT:0)|(t.metaKey?Monitor.Handler.MOD_META:0);return e==this.keyMask},CLASS_NAME:"Monitor.Handler"}),Monitor.Handler.MOD_NONE=0,Monitor.Handler.MOD_SHIFT=1,Monitor.Handler.MOD_CTRL=2,Monitor.Handler.MOD_ALT=4,Monitor.Handler.MOD_META=8,Monitor.Handler.Drag=Monitor.Class(Monitor.Handler,{started:!1,dragging:!1,start:null,last:null,init:function(t,e,r){Monitor.Handler.prototype.init.apply(this,arguments)},dragstart:function(t){this.dragging=!1,this.checkModifiers(t)?(this.started=!0,this.start=t.xy,this.last=t.xy,this.callback("start",t.xy)):(this.started=!1,this.start=null,this.last=null)},dragmove:function(t){return this.dragging=!1,!this.started||t.xy.x==this.last.x&&t.xy.y==this.last.y||(this.dragging=!0,this.callback("move",t.xy),this.last=t.xy),!0},dragend:function(t){this.started&&(this.started=!1,this.dragging=!1,this.callback("end",t.xy))},mousedown:function(t){this.dragstart(t)},mousemove:function(t){this.dragmove(t)},mouseup:function(t){this.dragend(t)},CLASS_NAME:"Monitor.Handler.Drag"}),Monitor.Control=Monitor.Class({map:null,active:!1,handler:null,init:function(t){Monitor.Util.extend(this,t)},setMap:function(t){this.map=t,this.handler&&this.handler.setMap(t)},activate:function(){return this.active?!1:(this.handler&&this.handler.activate(),this.active=!0,!0)},deactivate:function(){return this.active?(this.handler&&this.handler.deactivate(),this.active=!1,!0):!1},CLASS_NAME:"Monitor.Control"}),Monitor.Control.DragPan=Monitor.Class(Monitor.Control,{init:function(t){Monitor.Control.prototype.init.apply(this,arguments),this.handler=new Monitor.Handler.Drag(this,{start:this.panMapStart,move:this.panMap,end:this.panMapDone})},panMapStart:function(t){},panMap:function(t){},panMapDone:function(t){},CLASS_NAME:"Monitor.Control.DragPan"}),Monitor.Control.ModifyFeature=Monitor.Class(Monitor.Control,{layer:null,layers:null,selectedFeature:null,selectedFeatures:null,locked:!1,knobSize:20,resizeFeature:null,events:null,init:function(t,e){Monitor.Control.prototype.init.apply(this,[e]),Monitor.Util.isArray(t)||(t=[t]),this.layers=t,this.handler=new Monitor.Handler.Drag(this,{start:this.dragstart,move:this.dragmove,end:this.dragend}),this.layer=new Monitor.Layer.Vector("编辑图层"),this.selectedFeatures=[],this.events=new Monitor.Events(this)},dragstart:function(t){if(this.locked)return!1;var e=this.layer.getFeatureFromXY(t);if(e)e=e.__parent__;else{for(var r=this.map.layers.length,i=r-1;!e&&i>-1;i--)for(var n=this.layers.length,o=0;n>o&&(this.map.layers[i]!=this.layers[o]||!(e=this.layers[o].getFeatureFromXY(t)));o++);if(this.unselectAll(e),!e)return void this.events.trigger("featureunselected");Monitor.Array.contains(this.selectedFeatures,e)||(this.select(e),this.events.trigger("featureselected",e))}for(var s,a=[],l=this.selectedFeatures.length,i=0;l>i;i++)s=this.selectedFeatures[i],s._layer=s.layer,s.layer=this.layer,Monitor.Array.contains(a,s.layer)||a.push(s._layer);this.layer.renderer.erase();for(var i=0;i<a.length;i++)a[i].redraw();for(var h,u,l=this.selectedFeatures.length,i=0;l>i;i++){u=this.selectedFeatures[i].__features__,h=u.length;for(var o=0;h>o;o++)u[o].draw()}this.resizeFeature=null,u=e.__features__,h=u.length;for(var i=h-1;i>0;i--)if(u[i].geometry.isPointInRange(t.x,t.y)){this.resizeFeature=u[i];break}},dragmove:function(t){this.locked=!0,this.resizeFeature?this.resizeFeatures(t):this.moveFeatures(t),this.locked=!1},dragend:function(t){for(var e=[],r=0;r<this.selectedFeatures.length;r++)this.selectedFeatures[r].layer=this.selectedFeatures[r]._layer,Monitor.Array.contains(e,this.selectedFeatures[r].layer)||e.push(this.selectedFeatures[r].layer);for(var r=0;r<e.length;r++)e[r].redraw();this.layer.redraw(),this.resizeFeature=null},moveFeatures:function(t){var e,r,i,n=t.x-this.handler.last.x,o=t.y-this.handler.last.y,s=this.selectedFeatures,a=s.length;this.layer.renderer.erase();for(var l=0;a>l;l++){i=s[l],i.geometry.move(n,o),i.draw(),e=i.__features__,r=e.length,this.events.trigger("featuremodified",i);for(var h=0;r>h;h++)e[h].geometry.move(n,o),e[h].draw()}},resizeFeatures:function(t){var e=this.resizeFeature.__parent__,r=this.resizeFeature.__index__,i=0,n=0,o=t.x-this.handler.last.x,s=t.y-this.handler.last.y,a=!0;if(a){var l;switch(r){case 1:l=.5*(o+s),i=n=l,o=s=-i;break;case 2:l=.5*(o-s),s=o=l,n=-l;break;case 3:l=.5*(o+s),o=s=l;break;case 4:l=.5*(s-o),s=o=l,i=-l}}else{var h=t.x<e.geometry.x+e.geometry.width/2,u=t.y<e.geometry.y+e.geometry.height/2;h&&(i=o,o=-i),u&&(n=s,s=-n)}var c,d,f=this.selectedFeatures,p=f.length;this.layer.renderer.erase();for(var g,v,y,m,M=0;p>M;M++)d=f[M],g=0,v=0,y=0,m=0,d.geometry.width+o>d.geometry.minWidth&&d.geometry.height+s>d.geometry.minHeight&&(g=i,v=n,y=o,m=s),d.geometry.resize(y,m),d.geometry.move(g,v),d.draw(),this.events.trigger("featuremodified",d),c=d.__features__,c[0].geometry.resize(y,m),c[0].geometry.move(g,v),c[0].draw(),c[1].geometry.move(g,v),c[1].draw(),c[2].geometry.move(y+g,v),c[2].draw(),c[3].geometry.move(y+g,m+v),c[3].draw(),c[4].geometry.move(g,m+v),c[4].draw()},select:function(t){var e=new Monitor.Pen({stroke:"#4a86e8",strokeThickness:1}),r=new Monitor.Pen({fill:"#4a86e8"}),i=this.knobSize,n=t.geometry.x,o=t.geometry.y,s=t.geometry.width,a=t.geometry.height,l=new Monitor.Geometry.Rectangle({x:n,y:o,width:s,height:a,pen:e}),h=new Monitor.Feature.Vector(l);h.__parent__=t,h.__index__=0;var u=new Monitor.Geometry.Circle({x:n-i/2,y:o-i/2,width:i,height:i,pen:r}),c=new Monitor.Feature.Vector(u);c.__parent__=t,c.__index__=1;var d=new Monitor.Geometry.Circle({x:n+s-i/2,y:o-i/2,width:i,height:i,pen:r}),f=new Monitor.Feature.Vector(d,{index:2});f.__parent__=t,f.__index__=2;var p=new Monitor.Geometry.Circle({x:n+s-i/2,y:o+a-i/2,width:i,height:i,pen:r}),g=new Monitor.Feature.Vector(p,{index:3});g.__parent__=t,g.__index__=3;var v=new Monitor.Geometry.Circle({x:n-i/2,y:o+a-i/2,width:i,height:i,pen:r}),y=new Monitor.Feature.Vector(v,{index:4});y.__parent__=t,y.__index__=4,t.__features__=[h,c,f,g,y],this.layer.addFeatures(t.__features__),this.selectedFeatures.push(t)},unselect:function(t){var e=t.__features__;e&&this.layer.removeFeatures(e),t.__features__.length=0,delete t.__features__,Monitor.Array.remove(this.selectedFeatures,t)},unselectAll:function(t){this.locked=!0;for(var e,r,i=this.selectedFeatures.length;i--;)e=this.selectedFeatures[i],t!=e&&(r=e.__features__,r&&(this.layer.removeFeatures(r),e.__features__.length=0,delete e.__features__),this.selectedFeatures.splice(i,1));this.locked=!1},activate:function(){var t=Monitor.Control.prototype.activate.apply(this,arguments);return t&&this.map&&this.map.addLayer(this.layer),t},deactivate:function(){var t=Monitor.Control.prototype.deactivate(this,arguments);return t&&this.map&&this.map.removeLayer(this.layer),t},CLASS_NAME:"Monitor.Control.ModifyFeature"}),DLBiaoPan=Monitor.Class(Monitor.Geometry,{min:0,max:100,value:0,backgroundColor:"#ddd",title:"仪表",init:function(t){Monitor.Geometry.prototype.init.apply(this,arguments)},draw:function(t){Monitor.Geometry.prototype.draw.apply(this,arguments);var e=this.width,r=this.height;t.drawRectangle({fill:this.backgroundColor},0,0,e,r),t.drawLine({stroke:"#eee",strokeThickness:3},0,0,e,0),t.drawLine({stroke:"#eee",strokeThickness:3},0,0,0,r),t.drawLine({stroke:"#aaa",strokeThickness:3},e,0,e,r),t.drawLine({stroke:"#aaa",strokeThickness:3},0,r,e,r),t.drawCircle({fill:"#333",stroke:"#bbb",strokeThickness:.02*e},.08*e,.08*r,.03*e),t.drawCircle({fill:"#333",stroke:"#bbb",strokeThickness:.02*e},.92*e,.08*r,.03*e),t.drawCircle({fill:"#333",stroke:"#bbb",strokeThickness:.02*e},.08*e,.92*r,.03*e),t.drawCircle({fill:"#333",stroke:"#bbb",strokeThickness:.02*e},.92*e,.92*r,.03*e),t.drawCircle({fill:"#274e13",stroke:"#333",strokeThickness:1},.5*e,.5*r,.41*e),t.drawCircle({fill:"#fff",stroke:"#333",strokeThickness:1},.5*e,.5*r,.38*e),t.drawCircle({fill:"#333"},.5*e,.5*r,.02*e),t.drawText({fill:this.foregroundColor,font:.08*e+"px 宋体"},this.title,.5*e,.75*r,-.5,.5);var i,n,o,s,a=.75*Math.PI,l={stroke:"#333",strokeThickness:.008*e};n=1.5*Math.PI/20;for(var h=0;21>h;h++)i=a+n*h,s=Math.sin(i),o=Math.cos(i),t.drawLine(l,.5*e+.32*e*o,.5*r+.32*r*s,.5*e+.36*e*o,.5*r+.36*r*s);var u={fill:"#333",font:.05*e+"px 宋体"};n=1.5*Math.PI/10;var c=(this.max-this.min)/10;l.strokeThickness=.01*e;for(var h=0;11>h;h++)i=a+n*h,s=Math.sin(i),o=Math.cos(i),t.drawLine(l,.5*e+.32*e*o,.5*r+.32*r*s,.5*e+.36*e*o,.5*r+.36*r*s),t.drawText(u,h*c,.5*e+.24*e*o,.5*r+.24*r*s,-.5,.5);l.stroke="red",l.strokeThickness=.02*e,i=a+1.5*Math.PI*this.value/(this.max-this.min),s=Math.sin(i),o=Math.cos(i),t.drawLine(l,.5*e,.5*r,.5*e+.3*e*o,.5*r+.3*r*s),this.getBounds()},CLASS_NAME:"DLBiaoPan"}),Temprary=Monitor.Class(Monitor.Geometry,{min:0,max:100,value:0,backgroundColor:"#ccc",title:"指示器",init:function(t){Monitor.Geometry.prototype.init.apply(this,arguments)},draw:function(t){Monitor.Geometry.prototype.draw.apply(this,arguments);var e=this.width,r=this.height,i={stroke:"#333",strokeThickness:1},n={stroke:"#eee",strokeThickness:1};t.drawRectangle({fill:this.backgroundColor},0,0,e,r),t.drawLine({stroke:"#fff",strokeThickness:5},0,0,e,0),t.drawLine({stroke:"#fff",strokeThickness:5},0,0,0,r),t.drawLine({stroke:"#aaa",strokeThickness:5},e,0,e,r),t.drawLine({stroke:"#aaa",strokeThickness:5},0,r,e,r);var o=this.value/(this.max-this.min);t.drawRectangle({fill:"red"},.2*e,.12*r+.68*r*(1-o),.1*e,.68*r*o),t.drawLine(i,.2*e,.12*r,.2*e,.8*r),t.drawLine(i,.2*e,.12*r,.3*e,.12*r),t.drawLine(n,.3*e,.12*r,.3*e,.8*r),t.drawLine(n,.2*e,.8*r,.3*e,.8*r);for(var s=.35*e,a=.45*e,l=.55*e,h=.12*r,u=h+2,c=.68*r/20,d=0;21>d;d++)t.drawLine(i,s,h+c*d,d%4==0?l:a,h+c*d),t.drawLine(n,s,u+c*d,d%4==0?l:a,u+c*d);t.drawText({fill:this.foregroundColor,font:.08*e+"px 宋体"},this.title,.5*e,.9*r,-.5,.5),this.getBounds()},CLASS_NAME:"Temprary"});
//# sourceMappingURL=http://ritacc.cn/monitor.js.map